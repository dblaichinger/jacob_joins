- recipe = session[:recipe_id].present? ? Recipe.find(session[:recipe_id]) : Recipe.new
- (3 - recipe.steps.count).times { recipe.steps.build }

:javascript
  $(document).ready(function(){
    $("#ingredients").elementOnDemand();
    $("#new_recipe").stepHighlighting();
    $("#new_recipe input[placeholder], textarea[placeholder]").placeholder();
  });

%h3
  = link_to "Fill in with fake data", "#", :onclick => "fill_in_recipe(); return false;"

= form_for recipe do |f|
  = handle_error_messages(recipe).html_safe if recipe.errors.any?
  #left
    #information.part-1
      %h1
        %strong 1 
        Whatâ€™s really 
        %span going on 
        here

      %hr

      %p
        Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. 

      #title
        = f.label :name, "Title", id:"titel"
        = f.text_field :name, :class => "required", size:"40"
      #portions
        = f.label :portions, "Portions"
        = f.text_field :portions, :class => "required", :style => "display: inline;"
      #duration
        = f.label :duration, "Preparation time", id:"recipe_duration"
        = f.text_field :duration, :class => "required"

    #ingredients.part-2
      %h1 
        %strong 2 
        Fill in tasty 
        %span ingredients 
        here!

      %hr

      %p
        Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet

      - if recipe.errors.any?
        = prefill_ingredient_fields(f, recipe).html_safe
      - else
        = render_default_ingredient_fields(f, recipe).html_safe

  #right
    #preparation
      %h1
        %strong 3 
        Tell him how to 
        %span prepare 
        the meal!

      %hr

      .part-3.steps
        - counter = 0
        = f.fields_for :steps do |step|
          .step.dynamicElement
            = step.label :description, "<span>#{counter + 1}</span> Step".html_safe, class:"step_label"
            - if counter == 0
              = step.text_area :description, :class => "required"
            - else
              = step.text_area :description
            - counter += 1
            #stepupload
              = step.hidden_field :id unless step.object.new_record?

              .upload_wrapper{:style => "#{ 'display: none;' if step.object.image.present? }"}
                %p Upload Image
                = step.file_field :image

              - if step.object.image.present?
                .image_preview
                  = image_tag step.object.image(:small)
                  = link_to "delete", recipes_delete_step_image_path(step.object.id), :class => "delete"
  
      #recipe_images.part-4
        %h1 Images
        = file_field_tag "recipe[images_attributes][0][attachment]", :multiple => true
        %ul.file_uploads
          - f.object.images.each do |i|
            %li
              = image_tag i.attachment(:small)
              = i.attachment_file_name
              = link_to "delete", recipes_delete_image_path(i.id), :class => "delete"
